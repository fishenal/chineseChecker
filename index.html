<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Chinese Checker - A board game</title>
    <script src="https://cdn.jsdelivr.net/npm/vue"></script>
    <script src="utils.js"></script>
    <script src="game.js"></script>
    <link rel="stylesheet" href="style.css">
  </head>
  <body>
    <div id="app">
        <div class="board">

                <div
                v-for="(point, i) in board"
                class="col"
                :class="{
                    'p1': point == 1,
                    'p2': point == 2,
                    'common': point == 0,
                    'hovern': point == -1,
                    'hoverjump': point == -2,
                    'chosen': i == recordP
                 }"
                v-on:click= "handleClick(i)"
                @mouseenter="handleHover(i, 1)"
                @mouseleave="handleHover(i, 0)"
                >
                 <!-- {{ i }} -->
                </div>

        </div>
    </div>
    <!-- page content -->
    <script>

        const chineseChecker = new Vue({
            el: '#app',
            data: {
                board: null,
                recordP: null,
                game: new Game()
            },
            created: function () {
                this.game.init()
                this.board = this.game.board
            },
            methods: {
                handleHover: function (x, type) {
                    // if (type == 0) {
                    //     this.board = this.game.getBoard()
                    // } else {
                    //     // console.log(this.game.nextPoints[x])
                    //     // console.log(this.game.jumpPoints[x])
                    //     this.board.forEach((col, i) => {
                    //         if (this.game.nextPoints[x].indexOf(i) > -1) {
                    //             this.board[i] = -1
                    //         }
                    //         if (this.game.jumpPoints[x].indexOf(i) > -1) {
                    //             this.board[i] = -2
                    //         }
                    //     })
                    // }
                    // this.$forceUpdate()
                },
                handleClick: function (x) {
                    if (this.recordP != null) {
                        // single move
                        if (this.game.nextPoints[this.recordP].indexOf(x) > -1) {
                            const v1 = this.board[this.recordP]
                            this.board.splice(this.recordP, 1, this.board[x])
                            this.board.splice(x, 1, v1)
                            // re calculate jump points
                            this.game.genJumpPoints()
                        }

                        // jump move
                        const paths = this.game.findPath(this.recordP, x)
                        if (paths.length > 1) {
                            for (let i = paths.length - 1; i > 0; i --) {
                                setTimeout(() => {
                                    const startIdx = paths[i]
                                    const endIdx = paths[i - 1]
                                    const v1 = this.board[startIdx]
                                    this.board.splice(startIdx, 1, this.board[endIdx])
                                    this.board.splice(endIdx, 1, v1)
                                    // re calculate jump points
                                    this.game.genJumpPoints()
                                }, (paths.length - 1 - i) * 100)
                            }
                        }
                        this.recordP = null
                    } else {
                        this.recordP = x
                    }
                },
            }
        })
    </script>
  </body>
</html>